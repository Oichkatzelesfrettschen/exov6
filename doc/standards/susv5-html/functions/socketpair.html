<!-- Copyright 2001-2024 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML>
<html lang="en">
<head>
<meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2024 The Open Group, All Rights Reserved -->
<title>socketpair</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/socket.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/sqrt.html" accesskey="N">Next &gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
<center><font size="2">The Open Group Base Specifications Issue 8<br>
IEEE Std 1003.1-2024<br>
Copyright © 2001-2024 The IEEE and The Open Group</font></center>
<hr size="2" noshade>
<a name="top" id="top"></a> <a name="socketpair" id="socketpair"></a> <a name="tag_17_565" id="tag_17_565"></a><!-- socketpair -->
<h4 class="mansect"><a name="tag_17_565_01" id="tag_17_565_01"></a>NAME</h4>
<blockquote>socketpair — create a pair of connected sockets</blockquote>
<h4 class="mansect"><a name="tag_17_565_02" id="tag_17_565_02"></a>SYNOPSIS</h4>
<blockquote class="synopsis">
<p><code><tt>#include &lt;<a href="../basedefs/sys_socket.h.html">sys/socket.h</a>&gt;<br>
<br>
int socketpair(int</tt> <i>domain</i><tt>, int</tt> <i>type</i><tt>, int</tt> <i>protocol</i><tt>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int</tt> <i>socket_vector</i><tt>[2]);<br></tt></code></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_03" id="tag_17_565_03"></a>DESCRIPTION</h4>
<blockquote>
<p>The <i>socketpair</i>() function shall create an unbound pair of connected sockets in a specified <i>domain</i>, of a specified
<i>type</i>, under the protocol optionally specified by the <i>protocol</i> argument. The two sockets shall be identical. The file
descriptors used in referencing the created sockets shall be returned in <i>socket_vector</i>[0] and <i>socket_vector</i>[1]. The
file descriptors shall be allocated as described in <a href="../functions/V2_chap02.html#tag_16_06"><i>2.6 File Descriptor
Allocation</i></a>.</p>
<p>The <i>socketpair</i>() function takes the following arguments:</p>
<dl compact>
<dd></dd>
<dt><i>domain</i></dt>
<dd>Specifies the communications domain in which the sockets are to be created.</dd>
<dt><i>type</i></dt>
<dd>Specifies the type of sockets to be created.</dd>
<dt><i>protocol</i></dt>
<dd>Specifies a particular protocol to be used with the sockets. Specifying a <i>protocol</i> of 0 causes <i>socketpair</i>() to
use an unspecified default protocol appropriate for the requested socket type.</dd>
<dt><i>socket_vector</i></dt>
<dd>Specifies a 2-integer array to hold the file descriptors of the created socket pair.</dd>
</dl>
<p>The <i>type</i> argument specifies the socket type, which determines the semantics of communications over the socket. The
following socket types are defined; implementations may specify additional socket types:</p>
<dl compact>
<dd></dd>
<dt>SOCK_STREAM</dt>
<dd>Provides sequenced, reliable, bidirectional, connection-mode byte streams, and may provide a transmission mechanism for
out-of-band data.</dd>
<dt>SOCK_DGRAM</dt>
<dd>Provides datagrams, which are connectionless-mode, unreliable messages of fixed maximum length.</dd>
<dt>SOCK_SEQPACKET</dt>
<dd>Provides sequenced, reliable, bidirectional, connection-mode transmission paths for records. A record can be sent using one or
more output operations and received using one or more input operations, but a single operation never transfers part of more than
one record. Record boundaries are visible to the receiver via the MSG_EOR flag.</dd>
</dl>
<p>Additionally, the <i>type</i> argument can contain the bitwise-inclusive OR of flags from the following list:</p>
<dl compact>
<dd></dd>
<dt>SOCK_CLOEXEC</dt>
<dd>Atomically set the FD_CLOEXEC flag on the new file descriptors.</dd>
<dt>SOCK_CLOFORK</dt>
<dd>Atomically set the FD_CLOFORK flag on the new file descriptors.</dd>
<dt>SOCK_NONBLOCK</dt>
<dd>Set the O_NONBLOCK file status flag on the new file descriptions.</dd>
</dl>
<p>Implementations may define additional flags.</p>
<p>If the <i>protocol</i> argument is non-zero, it shall specify a protocol that is supported by the address family. If the
<i>protocol</i> argument is zero, the default protocol for this address family and type shall be used. The protocols supported by
the system are implementation-defined.</p>
<p>The process may need to have appropriate privileges to use the <i>socketpair</i>() function or to create some sockets.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_04" id="tag_17_565_04"></a>RETURN VALUE</h4>
<blockquote>
<p>Upon successful completion, this function shall return 0; otherwise, -1 shall be returned and <i>errno</i> set to indicate the
error, no file descriptors shall be allocated, and the contents of <i>socket_vector</i> shall be left unmodified.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_05" id="tag_17_565_05"></a>ERRORS</h4>
<blockquote>
<p>The <i>socketpair</i>() function shall fail if:</p>
<dl compact>
<dd></dd>
<dt>[EAFNOSUPPORT]</dt>
<dd>
The implementation does not support the specified address family.</dd>
<dt>[EMFILE]</dt>
<dd>All, or all but one, of the file descriptors available to the process are currently open.</dd>
<dt>[ENFILE]</dt>
<dd>No more file descriptors are available for the system.</dd>
<dt>[EOPNOTSUPP]</dt>
<dd>The specified protocol does not permit creation of socket pairs.</dd>
<dt>[EPROTONOSUPPORT]</dt>
<dd>
The protocol is not supported by the address family, or the protocol is not supported by the implementation.</dd>
<dt>[EPROTOTYPE]</dt>
<dd>The socket type is not supported by the protocol.</dd>
</dl>
<p>The <i>socketpair</i>() function may fail if:</p>
<dl compact>
<dd></dd>
<dt>[EACCES]</dt>
<dd>The process does not have appropriate privileges.</dd>
<dt>[ENOBUFS]</dt>
<dd>Insufficient resources were available in the system to perform the operation.</dd>
<dt>[ENOMEM]</dt>
<dd>Insufficient memory was available to fulfill the request.</dd>
</dl>
</blockquote>
<hr>
<div class="box"><em>The following sections are informative.</em></div>
<h4 class="mansect"><a name="tag_17_565_06" id="tag_17_565_06"></a>EXAMPLES</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_07" id="tag_17_565_07"></a>APPLICATION USAGE</h4>
<blockquote>
<p>The documentation for specific address families specifies which protocols each address family supports. The documentation for
specific protocols specifies which socket types each protocol supports.</p>
<p>The <i>socketpair</i>() function is used primarily with UNIX domain sockets and need not be supported for other domains.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_08" id="tag_17_565_08"></a>RATIONALE</h4>
<blockquote>
<p>The use of the SOCK_CLOEXEC and SOCK_CLOFORK flags in the <i>type</i> argument of <i>socketpair</i>() is necessary to avoid a
data race in multi-threaded applications. Without SOCK_CLOFORK, a file descriptor is leaked into a child process created by one
thread in the window between another using <i>socketpair</i>() and using using <a href="../functions/fcntl.html"><i>fcntl</i>()</a>
to set the FD_CLOFORK flag. Without SOCK_CLOEXEC, a file descriptor intentionally inherited by child processes is similarly leaked
into an executed program if FD_CLOEXEC is not set atomically.</p>
<p>Since socket pairs are often used for communication between a parent and child process, SOCK_CLOFORK has to be used with care in
order for the pair to be usable. If the parent will be writing and the child will be reading, SOCK_CLOFORK should be used when
creating the pair, and then <a href="../functions/fcntl.html"><i>fcntl</i>()</a> should be used to clear FD_CLOFORK for the read
side of the pair. This prevents the write side from leaking into other children, ensuring the child will get end-of-file when the
parent closes the write side (although the read side can still be leaked). If the parent will be reading and the child will be
writing, or if the socket pair will be used bidirectionally, there is no way to prevent the write side(s) being leaked (short of
preventing other threads from creating child processes) in order to ensure the parent gets end-of-file when the child closes its
side, and so the two processes should use an alternative method of indicating the end of communications, for example using <a href=
"../functions/shutdown.html"><i>shutdown</i>()</a>.</p>
<p>Arranging for FD_CLOEXEC to be set appropriately is more straightforward. The parent should use SOCK_CLOEXEC when creating the
socket pair and the child should clear FD_CLOEXEC on the side to be passed to the new program before calling an <i><a href=
"../functions/exec.html">exec</a></i> family function to execute it.</p>
<p>The SOCK_NONBLOCK flag is for convenience in avoiding additional <a href="../functions/fcntl.html"><i>fcntl</i>()</a> calls.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_09" id="tag_17_565_09"></a>FUTURE DIRECTIONS</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_10" id="tag_17_565_10"></a>SEE ALSO</h4>
<blockquote>
<p><a href="../functions/V2_chap02.html#tag_16_06"><i>2.6 File Descriptor Allocation</i></a>, <a href=
"../functions/socket.html#"><i>socket</i>()</a></p>
<p>XBD <a href="../basedefs/sys_socket.h.html"><i>&lt;sys/socket.h&gt;</i></a></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_11" id="tag_17_565_11"></a>CHANGE HISTORY</h4>
<blockquote>
<p>First released in Issue 6. Derived from the XNS, Issue 5.2 specification.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_12" id="tag_17_565_12"></a>Issue 7</h4>
<blockquote>
<p>The description of the [EMFILE] error condition is aligned with the <a href="../functions/pipe.html"><i>pipe</i>()</a>
function.</p>
<p>POSIX.1-2008, Technical Corrigendum 2, XSH/TC2-2008/0336 [835] and XSH/TC2-2008/0337 [483,835] are applied.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_565_13" id="tag_17_565_13"></a>Issue 8</h4>
<blockquote>
<p>Austin Group Defects 411 and 1318 are applied, adding SOCK_CLOEXEC, SOCK_CLOFORK, and SOCK_NONBLOCK.</p>
</blockquote>
<div class="box"><em>End of informative text.</em></div>
<hr>
<p>&nbsp;</p>
<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX® is a registered Trademark of The Open Group.<br>
POSIX™ is a Trademark of The IEEE.<br>
Copyright © 2001-2024 The IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>
<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/socket.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/sqrt.html" accesskey="N">Next &gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
</body>
</html>
