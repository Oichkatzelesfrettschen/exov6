<!-- Copyright 2001-2024 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML>
<html lang="en">
<head>
<meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2024 The Open Group, All Rights Reserved -->
<title>accept</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/abs.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/access.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
<center><font size="2">The Open Group Base Specifications Issue 8<br>
IEEE Std 1003.1-2024<br>
Copyright © 2001-2024 The IEEE and The Open Group</font></center>
<hr size="2" noshade>
<a name="top" id="top"></a> <a name="accept" id="accept"></a> <a name="tag_17_06" id="tag_17_06"></a><!-- accept -->
<h4 class="mansect"><a name="tag_17_06_01" id="tag_17_06_01"></a>NAME</h4>
<blockquote>accept, accept4 — accept a new connection on a socket</blockquote>
<h4 class="mansect"><a name="tag_17_06_02" id="tag_17_06_02"></a>SYNOPSIS</h4>
<blockquote class="synopsis">
<p><code><tt>#include &lt;<a href="../basedefs/sys_socket.h.html">sys/socket.h</a>&gt;<br>
<br>
int accept(int</tt> <i>socket</i><tt>, struct sockaddr *restrict</tt> <i>address</i><tt>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; socklen_t *restrict</tt> <i>address_len</i><tt>);<br>
int accept4(int</tt> <i>socket</i><tt>, struct sockaddr *restrict</tt> <i>address</i><tt>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; socklen_t *restrict</tt> <i>address_len</i><tt>, int</tt> <i>flag</i><tt>);<br></tt></code></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_03" id="tag_17_06_03"></a>DESCRIPTION</h4>
<blockquote>
<p>The <i>accept</i>() function shall extract the first connection on the queue of pending connections, create a new socket with
the same socket type protocol and address family as the specified socket, and allocate a new file descriptor for that socket. The
file descriptor shall be allocated as described in <a href="../functions/V2_chap02.html#tag_16_06"><i>2.6 File Descriptor
Allocation</i></a>.</p>
<p>The <i>accept</i>() function takes the following arguments:</p>
<dl compact>
<dd></dd>
<dt><i>socket</i></dt>
<dd>Specifies a socket that was created with <a href="../functions/socket.html"><i>socket</i>()</a>, has been bound to an address
with <a href="../functions/bind.html"><i>bind</i>()</a>, and has issued a successful call to <a href=
"../functions/listen.html"><i>listen</i>()</a>.</dd>
<dt><i>address</i></dt>
<dd>Either a null pointer, or a pointer to a <b>sockaddr</b> structure where the address of the connecting socket shall be
returned.</dd>
<dt><i>address_len</i></dt>
<dd>Either a null pointer, if <i>address</i> is a null pointer, or a pointer to a <b>socklen_t</b> object which on input specifies
the length of the supplied <b>sockaddr</b> structure, and on output specifies the length of the address of the connecting
socket.</dd>
</dl>
<p>If <i>address</i> is not a null pointer, the address of the peer for the accepted connection shall be stored in the
<b>sockaddr</b> structure pointed to by <i>address</i>, and the length of this address shall be stored in the object pointed to by
<i>address_len</i>.</p>
<p>If the actual length of the address is greater than the length of the supplied <b>sockaddr</b> structure, the stored address
shall be truncated.</p>
<p>If the protocol permits connections by unbound clients, and the peer is not bound, then the value stored in the object pointed
to by <i>address</i> is unspecified.</p>
<p>If the listen queue is empty of connection requests and O_NONBLOCK is not set on the file descriptor for the socket,
<i>accept</i>() shall block until a connection is present. If the <a href="../functions/listen.html"><i>listen</i>()</a> queue is
empty of connection requests and O_NONBLOCK is set on the file descriptor for the socket, <i>accept</i>() shall fail and set
<i>errno</i> to [EAGAIN] or [EWOULDBLOCK].</p>
<p>The accepted socket cannot itself accept more connections. The original socket remains open and can accept more connections.</p>
<p>If O_NONBLOCK is set on the file description for <i>socket</i>, it is implementation-defined whether O_NONBLOCK will be set on
the file description created by <i>accept</i>(). FD_CLOEXEC and FD_CLOFORK for the new file descriptor shall be clear, regardless
of how they are currently set for <i>socket</i>.</p>
<p>It is implementation-defined which socket options, if any, on the accepted socket will have a default value determined by a
value previously customized by <a href="../functions/setsockopt.html"><i>setsockopt</i>()</a> on <i>socket</i>, rather than the
default value used for other new sockets.</p>
<p>The <i>accept4</i>() function shall be equivalent to the <i>accept</i>() function, except that the state of O_NONBLOCK on the
new file description, and FD_CLOEXEC and FD_CLOFORK on the returned file descriptor shall be determined solely by the <i>flag</i>
argument, which can be constructed from a bitwise-inclusive OR of flags from the following list:</p>
<dl compact>
<dd></dd>
<dt>SOCK_CLOEXEC</dt>
<dd>Atomically set the FD_CLOEXEC flag on the new file descriptor.</dd>
<dt>SOCK_CLOFORK</dt>
<dd>Atomically set the FD_CLOFORK flag on the new file descriptor.</dd>
<dt>SOCK_NONBLOCK</dt>
<dd>Set the O_NONBLOCK file status flag on the new file description.</dd>
</dl>
<p>Implementations may define additional flags.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_04" id="tag_17_06_04"></a>RETURN VALUE</h4>
<blockquote>
<p>Upon successful completion, <i>accept</i>() and <i>accept4</i>() shall return the non-negative file descriptor of the accepted
socket. Otherwise, -1 shall be returned, <i>errno</i> shall be set to indicate the error, and any object pointed to by
<i>address_len</i> shall remain unchanged.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_05" id="tag_17_06_05"></a>ERRORS</h4>
<blockquote>
<p>The <i>accept</i>() and <i>accept4</i>() functions shall fail if:</p>
<dl compact>
<dd></dd>
<dt>[EAGAIN] or [EWOULDBLOCK]</dt>
<dd>
O_NONBLOCK is set for the socket file descriptor and no connections are present to be accepted.</dd>
<dt>[EBADF]</dt>
<dd>The <i>socket</i> argument is not a valid file descriptor.</dd>
<dt>[ECONNABORTED]</dt>
<dd>
A connection has been aborted.</dd>
<dt>[EINTR]</dt>
<dd>The <i>accept</i>() function was interrupted by a signal that was caught before a valid connection arrived.</dd>
<dt>[EINVAL]</dt>
<dd>The <i>socket</i> is not accepting connections.</dd>
<dt>[EMFILE]</dt>
<dd>All file descriptors available to the process are currently open.</dd>
<dt>[ENFILE]</dt>
<dd>The maximum number of file descriptors in the system are already open.</dd>
<dt>[ENOBUFS]</dt>
<dd>No buffer space is available.</dd>
<dt>[ENOMEM]</dt>
<dd>There was insufficient memory available to complete the operation.</dd>
<dt>[ENOTSOCK]</dt>
<dd>The <i>socket</i> argument does not refer to a socket.</dd>
<dt>[EOPNOTSUPP]</dt>
<dd>The socket type of the specified socket does not support accepting connections.</dd>
</dl>
<p>The <i>accept</i>() and <i>accept4</i>() functions may fail if:</p>
<dl compact>
<dd></dd>
<dt>[EPROTO]</dt>
<dd>A protocol error has occurred.</dd>
</dl>
<p>The <i>accept4</i>() function may fail if:</p>
<dl compact>
<dd></dd>
<dt>[EINVAL]</dt>
<dd>The value of the <i>flag</i> argument is invalid.</dd>
</dl>
</blockquote>
<hr>
<div class="box"><em>The following sections are informative.</em></div>
<h4 class="mansect"><a name="tag_17_06_06" id="tag_17_06_06"></a>EXAMPLES</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_07" id="tag_17_06_07"></a>APPLICATION USAGE</h4>
<blockquote>
<p>When a connection is available, <a href="../functions/select.html"><i>select</i>()</a> indicates that the file descriptor for
the socket is ready for reading.</p>
<p>Many socket options are described as having implementation-defined default values, which may differ according to the protocol in
use by the socket. Existing practice differs on whether socket options such as SO_SNDBUF that were customized on the original
listening socket will impact the corresponding option on the newly returned socket. Implementations are permitted to allow
inheritance of customized settings where it makes sense, although the most portable approach for applications is to limit <a href=
"../functions/setsockopt.html"><i>setsockopt</i>()</a> customizations to only the accepted socket.</p>
<p>For AF_UNIX sockets, it is recommended that <i>address</i> points to a buffer of length greater than <tt>sizeof(struct
sockaddr_un)</tt> which has been initialized with null bytes. That way, even if the implementation supports the use of all bytes of
<i>sun_path</i> without a terminating null byte, the larger buffer guarantees that the <i>sun_path</i> member can then be passed to
other interfaces that expect a null-terminated string. If no truncation occurred based on the input value of <i>address_len</i>, it
is unspecified whether the returned <i>address_len</i> will be <tt>sizeof(struct sockaddr_un)</tt>, or merely a value at least as
large as <tt>offsetof(struct sockaddr_un, sun_path)</tt> plus the number of non-null bytes stored in <i>sun_path</i>.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_08" id="tag_17_06_08"></a>RATIONALE</h4>
<blockquote>
<p>The SOCK_CLOEXEC and SOCK_CLOFORK flags of <i>accept4</i>() are necessary to avoid a data race in multi-threaded applications.
Without SOCK_CLOFORK, a file descriptor is leaked into a child process created by one thread in the window between another thread
creating a file descriptor with <i>accept</i>() and then using <a href="../functions/fcntl.html"><i>fcntl</i>()</a> to set the
FD_CLOFORK flag. Without SOCK_CLOEXEC, a file descriptor intentionally inherited by child processes is similarly leaked into an
executed program if FD_CLOEXEC is not set atomically.</p>
<p>Two designs often used for network servers are multi-threaded servers with a pre-created pool of worker threads, where the
thread that accepts the connection request hands over the new file descriptor to a worker thread for servicing, and pre-fork
servers with a pre-created pool of worker processes, where the process that accepts the connection request passes the new file
descriptor (for example via <a href="../functions/sendmsg.html"><i>sendmsg</i>()</a>) to a worker process. In both of these
designs, <i>accept4</i>() should be used with the SOCK_CLOFORK flag set. Simpler designs are also sometimes used that do not
pre-create a pool. For a multi-threaded server that creates a thread to handle each request, SOCK_CLOFORK should still be used. For
a forking server that creates a child to service each request, clearly SOCK_CLOFORK cannot be used if the child is to inherit the
file descriptor to be serviced, and therefore this type of server needs to use an alternative method of indicating the end of
communications, for example using <a href="../functions/shutdown.html"><i>shutdown</i>()</a>, to ensure the client sees
end-of-file, rather than just closing the socket. Such child processes should set FD_CLOFORK on the inherited file descriptor
before they attempt to start any additional child processes to avoid leakage into those children.</p>
<p>The SOCK_NONBLOCK flag is for convenience in avoiding additional <a href="../functions/fcntl.html"><i>fcntl</i>()</a> calls, as
well as providing specific control over the O_NONBLOCK flag, since traditional implementations of <i>accept</i>() differ on whether
O_NONBLOCK is inherited from the <i>socket</i> argument.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_09" id="tag_17_06_09"></a>FUTURE DIRECTIONS</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_10" id="tag_17_06_10"></a>SEE ALSO</h4>
<blockquote>
<p><a href="../functions/V2_chap02.html#tag_16_06"><i>2.6 File Descriptor Allocation</i></a>, <a href=
"../functions/bind.html#"><i>bind</i>()</a>, <a href="../functions/connect.html#"><i>connect</i>()</a>, <a href=
"../functions/listen.html#"><i>listen</i>()</a>, <a href="../functions/socket.html#"><i>socket</i>()</a></p>
<p>XBD <a href="../basedefs/sys_socket.h.html"><i>&lt;sys/socket.h&gt;</i></a></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_11" id="tag_17_06_11"></a>CHANGE HISTORY</h4>
<blockquote>
<p>First released in Issue 6. Derived from the XNS, Issue 5.2 specification.</p>
<p>The <b>restrict</b> keyword is added to the <i>accept</i>() prototype for alignment with the ISO/IEC&nbsp;9899:1999
standard.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_12" id="tag_17_06_12"></a>Issue 7</h4>
<blockquote>
<p>SD5-XBD-ERN-4 is applied, changing the definition of the [EMFILE] error.</p>
<p>Austin Group Interpretation 1003.1-2001 #044 is applied, changing the &quot;may fail&quot; [ENOBUFS] and [ENOMEM] errors to become
&quot;shall fail&quot; errors.</p>
<p>Functionality relating to XSI STREAMS is marked obsolescent.</p>
<p>POSIX.1-2008, Technical Corrigendum 1, XSH/TC1-2008/0018 [464] is applied.</p>
<p>POSIX.1-2008, Technical Corrigendum 2, XSH/TC2-2008/0035 [835] and XSH/TC2-2008/0036 [836] are applied.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_06_13" id="tag_17_06_13"></a>Issue 8</h4>
<blockquote>
<p>Austin Group Defects 411 and 1318 are applied, adding <i>accept4</i>(), requiring FD_CLOEXEC and FD_CLOFORK to be clear for the
file descriptor returned by <i>accept</i>(), and clarifying the requirements for O_NONBLOCK on the file description created by
<i>accept</i>().</p>
<p>Austin Group Defect 561 is applied, adding a paragraph about <i>sun_path</i> to APPLICATION USAGE.</p>
<p>Austin Group Defect 1330 is applied, removing obsolescent interfaces.</p>
<p>Austin Group Defect 1337 is applied, clarifying socket option default values.</p>
<p>Austin Group Defect 1565 is applied, changing the description of <i>address_len</i>.</p>
</blockquote>
<div class="box"><em>End of informative text.</em></div>
<hr>
<p>&nbsp;</p>
<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX® is a registered Trademark of The Open Group.<br>
POSIX™ is a Trademark of The IEEE.<br>
Copyright © 2001-2024 The IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>
<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/abs.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/access.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
</body>
</html>
