<!-- Copyright 2001-2024 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML>
<html lang="en">
<head>
<meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2024 The Open Group, All Rights Reserved -->
<title>recvmsg</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/recvfrom.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/regcomp.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
<center><font size="2">The Open Group Base Specifications Issue 8<br>
IEEE Std 1003.1-2024<br>
Copyright © 2001-2024 The IEEE and The Open Group</font></center>
<hr size="2" noshade>
<a name="top" id="top"></a> <a name="recvmsg" id="recvmsg"></a> <a name="tag_17_484" id="tag_17_484"></a><!-- recvmsg -->
<h4 class="mansect"><a name="tag_17_484_01" id="tag_17_484_01"></a>NAME</h4>
<blockquote>recvmsg — receive a message from a socket</blockquote>
<h4 class="mansect"><a name="tag_17_484_02" id="tag_17_484_02"></a>SYNOPSIS</h4>
<blockquote class="synopsis">
<p><code><tt>#include &lt;<a href="../basedefs/sys_socket.h.html">sys/socket.h</a>&gt;<br>
<br>
ssize_t recvmsg(int</tt> <i>socket</i><tt>, struct msghdr *</tt><i>message</i><tt>, int</tt> <i>flags</i><tt>);<br></tt></code></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_03" id="tag_17_484_03"></a>DESCRIPTION</h4>
<blockquote>
<p>The <i>recvmsg</i>() function shall receive a message from a connection-mode or connectionless-mode socket. It is normally used
with connectionless-mode sockets because it permits the application to retrieve the source address of received data.</p>
<p>The <i>recvmsg</i>() function takes the following arguments:</p>
<dl compact>
<dd></dd>
<dt><i>socket</i></dt>
<dd>Specifies the socket file descriptor.</dd>
<dt><i>message</i></dt>
<dd>Points to a <b>msghdr</b> structure, containing both the buffer to store the source address and the buffers for the incoming
message. The length and format of the address depend on the address family of the socket. The <i>msg_flags</i> member is ignored on
input, but may contain meaningful values on output.</dd>
<dt><i>flags</i></dt>
<dd>Specifies the type of message reception. Values of this argument are formed by logically OR'ing zero or more of the following
values:
<dl compact>
<dd></dd>
<dt>MSG_OOB</dt>
<dd>Requests out-of-band data. The significance and semantics of out-of-band data are protocol-specific.</dd>
<dt>MSG_PEEK</dt>
<dd>Peeks at the incoming message.</dd>
<dt>MSG_WAITALL</dt>
<dd>On SOCK_STREAM sockets this requests that the function block until the full amount of data can be returned. The function may
return the smaller amount of data if the socket is a message-based socket, if a signal is caught, if the connection is terminated,
if MSG_PEEK was specified, or if an error is pending for the socket.</dd>
<dt>MSG_CMSG_CLOEXEC</dt>
<dd>
On sockets that permit a <i>cmsg_type</i> of SCM_RIGHTS in the <i>msg_control</i> ancillary data as a means of copying file
descriptors into the process, the file descriptors shall be created with the FD_CLOEXEC flag atomically set.</dd>
<dt>MSG_CMSG_CLOFORK</dt>
<dd>
On sockets that permit a <i>cmsg_type</i> of SCM_RIGHTS in the <i>msg_control</i> ancillary data as a means of copying file
descriptors into the process, the file descriptors shall be created with the FD_CLOFORK flag atomically set.</dd>
</dl>
</dd>
</dl>
<p>The <i>recvmsg</i>() function shall receive messages from unconnected or connected sockets and shall return the length of the
message.</p>
<p>The <i>recvmsg</i>() function shall return the total length of the message. For message-based sockets, such as SOCK_DGRAM and
SOCK_SEQPACKET, the entire message shall be read in a single operation. If a message is too long to fit in the supplied buffers,
and MSG_PEEK is not set in the <i>flags</i> argument, the excess bytes shall be discarded, and MSG_TRUNC shall be set in the
<i>msg_flags</i> member of the <b>msghdr</b> structure. For stream-based sockets, such as SOCK_STREAM, message boundaries shall be
ignored. In this case, data shall be returned to the user as soon as it becomes available, and no data shall be discarded.</p>
<p>If the MSG_WAITALL flag is not set, data shall be returned only up to the end of the first message.</p>
<p>If no messages are available at the socket and O_NONBLOCK is not set on the socket's file descriptor, <i>recvmsg</i>() shall
block until a message arrives or a timeout occurs (see SO_RCVTIMEO in <a href="../functions/V2_chap02.html#tag_16_10_16"><i>2.10.16
Use of Options</i></a>). If no messages are available at the socket and O_NONBLOCK is set on the socket's file descriptor, the
<i>recvmsg</i>() function shall fail and set <i>errno</i> to [EAGAIN] or [EWOULDBLOCK].</p>
<p>In the <b>msghdr</b> structure, the <i>msg_name</i> member may be a null pointer if the source address is not required.
Otherwise, if the socket is unconnected, the <i>msg_name</i> member points to a <b>sockaddr</b> structure in which the source
address is to be stored, and the <i>msg_namelen</i> member on input specifies the length of the supplied <b>sockaddr</b> structure
and on output specifies the length of the source address. If the actual length of the address is greater than the length of the
supplied <b>sockaddr</b> structure, the stored address shall be truncated. If the socket is connected, the <i>msg_name</i> and
<i>msg_namelen</i> members shall be ignored. The <i>msg_iov</i> and <i>msg_iovlen</i> fields are used to specify where the received
data shall be stored. The <i>msg_iov</i> member points to an array of <b>iovec</b> structures; the <i>msg_iovlen</i> member shall
be set to the dimension of this array. In each <b>iovec</b> structure, the <i>iov_base</i> field specifies a storage area and the
<i>iov_len</i> field gives its size in bytes. Each storage area indicated by <i>msg_iov</i> is filled with received data in turn
until all of the received data is stored or all of the areas have been filled.</p>
<p>Upon successful completion, the <i>msg_flags</i> member of the message header shall be the bitwise-inclusive OR of all of the
following flags that indicate conditions detected for the received message:</p>
<dl compact>
<dd></dd>
<dt>MSG_EOR</dt>
<dd>End-of-record was received (if supported by the protocol).</dd>
<dt>MSG_OOB</dt>
<dd>Out-of-band data was received.</dd>
<dt>MSG_TRUNC</dt>
<dd>Normal data was truncated.</dd>
<dt>MSG_CTRUNC</dt>
<dd>Control data was truncated.</dd>
</dl>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_04" id="tag_17_484_04"></a>RETURN VALUE</h4>
<blockquote>
<p>Upon successful completion, <i>recvmsg</i>() shall return the length of the message in bytes. If no messages are available to be
received and the peer has performed an orderly shutdown, <i>recvmsg</i>() shall return 0. Otherwise, -1 shall be returned and
<i>errno</i> set to indicate the error.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_05" id="tag_17_484_05"></a>ERRORS</h4>
<blockquote>
<p>The <i>recvmsg</i>() function shall fail if:</p>
<dl compact>
<dd></dd>
<dt>[EAGAIN] or [EWOULDBLOCK]</dt>
<dd>
The socket's file descriptor is marked O_NONBLOCK and no data is waiting to be received; or MSG_OOB is set and no out-of-band data
is available and either the socket's file descriptor is marked O_NONBLOCK or the socket does not support blocking to await
out-of-band data. See also SO_RCVTIMEO in <a href="../functions/V2_chap02.html#tag_16_10_16"><i>2.10.16 Use of Options</i></a>
.</dd>
<dt>[EBADF]</dt>
<dd>The <i>socket</i> argument is not a valid open file descriptor.</dd>
<dt>[ECONNRESET]</dt>
<dd>A connection was forcibly closed by a peer.</dd>
<dt>[EINTR]</dt>
<dd>This function was interrupted by a signal before any data was available.</dd>
<dt>[EINVAL]</dt>
<dd>The sum of the <i>iov_len</i> values overflows a <b>ssize_t</b>, or the MSG_OOB flag is set and no out-of-band data is
available.</dd>
<dt>[EMSGSIZE]</dt>
<dd>The <i>msg_iovlen</i> member of the <b>msghdr</b> structure pointed to by <i>message</i> is less than or equal to 0, or is
greater than {IOV_MAX}.</dd>
<dt>[ENOTCONN]</dt>
<dd>A receive is attempted on a connection-mode socket that is not connected.</dd>
<dt>[ENOTSOCK]</dt>
<dd>The <i>socket</i> argument does not refer to a socket.</dd>
<dt>[EOPNOTSUPP]</dt>
<dd>The specified flags are not supported for this socket type.</dd>
<dt>[ETIMEDOUT]</dt>
<dd>The connection timed out during connection establishment, or due to a transmission timeout on active connection.</dd>
</dl>
<p>The <i>recvmsg</i>() function may fail if:</p>
<dl compact>
<dd></dd>
<dt>[EIO]</dt>
<dd>An I/O error occurred while reading from or writing to the file system.</dd>
<dt>[ENOBUFS]</dt>
<dd>Insufficient resources were available in the system to perform the operation.</dd>
<dt>[ENOMEM]</dt>
<dd>Insufficient memory was available to fulfill the request.</dd>
</dl>
</blockquote>
<hr>
<div class="box"><em>The following sections are informative.</em></div>
<h4 class="mansect"><a name="tag_17_484_06" id="tag_17_484_06"></a>EXAMPLES</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_07" id="tag_17_484_07"></a>APPLICATION USAGE</h4>
<blockquote>
<p>The <a href="../functions/select.html"><i>select</i>()</a> and <a href="../functions/poll.html"><i>poll</i>()</a> functions can
be used to determine when data is available to be received.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_08" id="tag_17_484_08"></a>RATIONALE</h4>
<blockquote>
<p>The use of the MSG_CMSG_CLOEXEC and MSG_CMSG_CLOFORK flags to <i>recvmsg</i>() when using SCM_RIGHTS to receive file descriptors
via ancillary data is necessary to avoid a data race in multi-threaded applications. Without MSG_CMSG_CLOFORK, a file descriptor is
leaked into a child process created by one thread in the window between another thread calling <i>recvmsg</i>() and using <a href=
"../functions/fcntl.html"><i>fcntl</i>()</a> to set the FD_CLOFORK flag. Without MSG_CMSG_CLOEXEC, a file descriptor intentionally
inherited by child processes is similarly leaked into an executed program if FD_CLOEXEC is not set atomically.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_09" id="tag_17_484_09"></a>FUTURE DIRECTIONS</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_10" id="tag_17_484_10"></a>SEE ALSO</h4>
<blockquote>
<p><a href="../functions/poll.html#"><i>poll</i>()</a>, <a href="../functions/pselect.html#"><i>pselect</i>()</a>, <a href=
"../functions/recv.html#"><i>recv</i>()</a>, <a href="../functions/recvfrom.html#"><i>recvfrom</i>()</a>, <a href=
"../functions/send.html#"><i>send</i>()</a>, <a href="../functions/sendmsg.html#"><i>sendmsg</i>()</a>, <a href=
"../functions/sendto.html#"><i>sendto</i>()</a>, <a href="../functions/setsockopt.html#"><i>setsockopt</i>()</a>, <a href=
"../functions/shutdown.html#"><i>shutdown</i>()</a>, <a href="../functions/socket.html#"><i>socket</i>()</a></p>
<p>XBD <a href="../basedefs/sys_socket.h.html"><i>&lt;sys/socket.h&gt;</i></a></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_11" id="tag_17_484_11"></a>CHANGE HISTORY</h4>
<blockquote>
<p>First released in Issue 6. Derived from the XNS, Issue 5.2 specification.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_12" id="tag_17_484_12"></a>Issue 7</h4>
<blockquote>
<p>POSIX.1-2008, Technical Corrigendum 1, XSH/TC1-2008/0504 [464] is applied.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_484_13" id="tag_17_484_13"></a>Issue 8</h4>
<blockquote>
<p>Austin Group Defects 411 and 1318 are applied, adding MSG_CMSG_CLOEXEC and MSG_CMSG_CLOFORK.</p>
<p>Austin Group Defect 1429 is applied, clarifying the behavior on timeout by adding references to <a href=
"../functions/V2_chap02.html#tag_16_10_16"><i>2.10.16 Use of Options</i></a>.</p>
<p>Austin Group Defect 1565 is applied, changing the description of <i>msg_namelen</i>.</p>
</blockquote>
<div class="box"><em>End of informative text.</em></div>
<hr>
<p>&nbsp;</p>
<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX® is a registered Trademark of The Open Group.<br>
POSIX™ is a Trademark of The IEEE.<br>
Copyright © 2001-2024 The IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>
<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/recvfrom.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/regcomp.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
</body>
</html>
