<!-- Copyright 2001-2024 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML>
<html lang="en">
<head>
<meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2024 The Open Group, All Rights Reserved -->
<title>mtx_lock</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/mtx_destroy.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/munmap.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
<script language="JavaScript" src="../jscript/codes.js"></script><basefont size="3">
<center><font size="2">The Open Group Base Specifications Issue 8<br>
IEEE Std 1003.1-2024<br>
Copyright © 2001-2024 The IEEE and The Open Group</font></center>
<hr size="2" noshade>
<a name="top" id="top"></a> <a name="mtx_lock" id="mtx_lock"></a> <a name="tag_17_362" id="tag_17_362"></a><!-- mtx_lock -->
<h4 class="mansect"><a name="tag_17_362_01" id="tag_17_362_01"></a>NAME</h4>
<blockquote>mtx_lock, mtx_timedlock, mtx_trylock, mtx_unlock — lock and unlock a mutex</blockquote>
<h4 class="mansect"><a name="tag_17_362_02" id="tag_17_362_02"></a>SYNOPSIS</h4>
<blockquote class="synopsis">
<p><code><tt>#include &lt;<a href="../basedefs/threads.h.html">threads.h</a>&gt;<br>
<br>
int mtx_lock(mtx_t *</tt><i>mtx</i><tt>);<br>
int mtx_timedlock(mtx_t *restrict</tt> <i>mtx</i><tt>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const struct timespec *restrict</tt> <i>ts</i><tt>);<br>
int mtx_trylock(mtx_t *</tt><i>mtx</i><tt>);<br>
int mtx_unlock(mtx_t *</tt><i>mtx</i><tt>);<br></tt></code></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_362_03" id="tag_17_362_03"></a>DESCRIPTION</h4>
<blockquote>
<div class="box"><sup>[<a href="javascript:open_code('CX')">CX</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]"
border="0"> The functionality described on this reference page is aligned with the ISO&nbsp;C standard. Any conflict between the
requirements described here and the ISO&nbsp;C standard is unintentional. This volume of POSIX.1-2024 defers to the ISO&nbsp;C
standard. <img src="../images/opt-end.gif" alt="[Option End]" border="0"></div>
<p>The <i>mtx_lock</i>() function shall block until it locks the mutex pointed to by <i>mtx</i>. If the mutex is non-recursive, the
application shall ensure that it is not already locked by the calling thread.</p>
<p>The <i>mtx_timedlock</i>() function shall block until it locks the mutex pointed to by <i>mtx</i> or until after the
TIME_UTC-based calendar time pointed to by <i>ts</i>. The application shall ensure that the specified mutex supports timeout.
<sup>[<a href="javascript:open_code('CX')">CX</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0"> Under
no circumstance shall the function fail with a timeout if the mutex can be locked immediately. The validity of the <i>ts</i>
parameter need not be checked if the mutex can be locked immediately. <img src="../images/opt-end.gif" alt="[Option End]" border=
"0"></p>
<p>The <i>mtx_trylock</i>() function shall endeavor to lock the mutex pointed to by <i>mtx</i>. If the mutex is already locked (by
any thread, including the current thread), the function shall return without blocking. If the mutex is recursive and the mutex is
currently owned by the calling thread, the mutex lock count (see below) shall be incremented by one and the <i>mtx_trylock</i>()
function shall immediately return success.</p>
<p><sup>[<a href="javascript:open_code('CX')">CX</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
These functions shall not be affected if the calling thread executes a signal handler during the call; if a signal is delivered to
a thread waiting for a mutex, upon return from the signal handler the thread shall resume waiting for the mutex as if it was not
interrupted. <img src="../images/opt-end.gif" alt="[Option End]" border="0"></p>
<p>If a call to <i>mtx_lock</i>(), <i>mtx_timedlock</i>() or <i>mtx_trylock</i>() locks the mutex, prior calls to
<i>mtx_unlock</i>() on the same mutex shall synchronize with this lock operation.</p>
<p>The <i>mtx_unlock</i>() function shall unlock the mutex pointed to by <i>mtx</i>. The application shall ensure that the mutex
pointed to by <i>mtx</i> is locked by the calling thread. <sup>[<a href="javascript:open_code('CX')">CX</a>]</sup> <img src=
"../images/opt-start.gif" alt="[Option Start]" border="0"> &nbsp;If there are threads blocked on the mutex object referenced by
<i>mtx</i> when <i>mtx_unlock</i>() is called, resulting in the mutex becoming available, the scheduling policy shall determine
which thread shall acquire the mutex. <img src="../images/opt-end.gif" alt="[Option End]" border="0"></p>
<p>A recursive mutex shall maintain the concept of a lock count. When a thread successfully acquires a mutex for the first time,
the lock count shall be set to one. Every time a thread relocks this mutex, the lock count shall be incremented by one. Each time
the thread unlocks the mutex, the lock count shall be decremented by one. When the lock count reaches zero, the mutex shall become
available for other threads to acquire.</p>
<p>For purposes of determining the existence of a data race, mutex lock and unlock operations on mutexes of type <b>mtx_t</b>
behave as atomic operations. All lock and unlock operations on a particular mutex occur in some particular total order.</p>
<p>If <i>mtx</i> does not refer to an initialized mutex object, the behavior of these functions is undefined.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_362_04" id="tag_17_362_04"></a>RETURN VALUE</h4>
<blockquote>
<p>The <i>mtx_lock</i>() and <i>mtx_unlock</i>() functions shall return <tt>thrd_success</tt> on success, or <tt>thrd_error</tt> if
the request could not be honored.</p>
<p>The <i>mtx_timedlock</i>() function shall return <tt>thrd_success</tt> on success, or <tt>thrd_timedout</tt> if the time
specified was reached without acquiring the requested resource, or <tt>thrd_error</tt> if the request could not be honored.</p>
<p>The <i>mtx_trylock</i>() function shall return <tt>thrd_success</tt> on success, or <tt>thrd_busy</tt> if the resource requested
is already in use, or <tt>thrd_error</tt> if the request could not be honored. The <i>mtx_trylock</i>() function can spuriously
fail to lock an unused resource, in which case it shall return <tt>thrd_busy</tt>.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_362_05" id="tag_17_362_05"></a>ERRORS</h4>
<blockquote>
<p>See RETURN VALUE.</p>
</blockquote>
<hr>
<div class="box"><em>The following sections are informative.</em></div>
<h4 class="mansect"><a name="tag_17_362_06" id="tag_17_362_06"></a>EXAMPLES</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_362_07" id="tag_17_362_07"></a>APPLICATION USAGE</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_362_08" id="tag_17_362_08"></a>RATIONALE</h4>
<blockquote>
<p>These functions are not affected by signal handlers for the reasons stated in XRAT <a href=
"../xrat/V4_xsh_chap01.html#tag_22_02_03"><i>B.2.3 Error Numbers</i></a>.</p>
<p>Since <a href="../basedefs/pthread.h.html"><i>&lt;pthread.h&gt;</i></a> has no equivalent of the <tt>mtx_timed</tt> mutex
property, if the <a href="../basedefs/threads.h.html"><i>&lt;threads.h&gt;</i></a> interfaces are implemented as a thin wrapper
around <a href="../basedefs/pthread.h.html"><i>&lt;pthread.h&gt;</i></a> interfaces (meaning <b>mtx_t</b> and
<b>pthread_mutex_t</b> are the same type), all mutexes support timeout and <i>mtx_timedlock</i>() will not fail for a mutex that
was not initialized with <tt>mtx_timed</tt>. Alternatively, implementations can use a less thin wrapper where <b>mtx_t</b> contains
additional properties that are not held in <b>pthread_mutex_t</b> in order to be able to return a failure indication from
<i>mtx_timedlock</i>() calls where the mutex was not initialized with <tt>mtx_timed</tt>.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_362_09" id="tag_17_362_09"></a>FUTURE DIRECTIONS</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_362_10" id="tag_17_362_10"></a>SEE ALSO</h4>
<blockquote>
<p><a href="../functions/mtx_destroy.html#"><i>mtx_destroy</i>()</a>, <a href=
"../functions/timespec_get.html#"><i>timespec_get</i>()</a></p>
<p>XBD <a href="../basedefs/threads.h.html"><i>&lt;threads.h&gt;</i></a></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_362_11" id="tag_17_362_11"></a>CHANGE HISTORY</h4>
<blockquote>
<p>First released in Issue 8. Included for alignment with the ISO/IEC&nbsp;9899:2018 standard.</p>
</blockquote>
<div class="box"><em>End of informative text.</em></div>
<hr>
<p>&nbsp;</p>
<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX® is a registered Trademark of The Open Group.<br>
POSIX™ is a Trademark of The IEEE.<br>
Copyright © 2001-2024 The IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>
<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/mtx_destroy.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/munmap.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
</body>
</html>
