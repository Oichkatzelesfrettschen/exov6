<!-- Copyright 2001-2024 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML>
<html lang="en">
<head>
<meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2024 The Open Group, All Rights Reserved -->
<title>pipe</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/perror.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/poll.html" accesskey="N">Next &gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
<center><font size="2">The Open Group Base Specifications Issue 8<br>
IEEE Std 1003.1-2024<br>
Copyright © 2001-2024 The IEEE and The Open Group</font></center>
<hr size="2" noshade>
<a name="top" id="top"></a> <a name="pipe" id="pipe"></a> <a name="tag_17_377" id="tag_17_377"></a><!-- pipe -->
<h4 class="mansect"><a name="tag_17_377_01" id="tag_17_377_01"></a>NAME</h4>
<blockquote>pipe, pipe2 — create an interprocess channel</blockquote>
<h4 class="mansect"><a name="tag_17_377_02" id="tag_17_377_02"></a>SYNOPSIS</h4>
<blockquote class="synopsis">
<p><code><tt>#include &lt;<a href="../basedefs/unistd.h.html">unistd.h</a>&gt;<br>
<br>
int pipe(int</tt> <i>fildes</i><tt>[2]);<br>
int pipe2(int</tt> <i>fildes</i><tt>[2], int</tt> <i>flag</i><tt>);<br></tt></code></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_03" id="tag_17_377_03"></a>DESCRIPTION</h4>
<blockquote>
<p>The <i>pipe</i>() function shall create a pipe and place two file descriptors, one each into the arguments <i>fildes</i>[0] and
<i>fildes</i>[1], that refer to the open file descriptions for the read and write ends of the pipe, respectively. The file
descriptors shall be allocated as described in <a href="../functions/V2_chap02.html#tag_16_06"><i>2.6 File Descriptor
Allocation</i></a>. The FD_CLOEXEC and FD_CLOFORK flags shall be clear on both file descriptors. The O_NONBLOCK flag shall be
clear on both open file descriptions. (The <a href="../functions/fcntl.html"><i>fcntl</i>()</a> function can be used to set this
flag.)</p>
<p>Data can be written to the file descriptor <i>fildes</i>[1] and read from the file descriptor <i>fildes</i>[0]. A read on the
file descriptor <i>fildes</i>[0] shall access data written to the file descriptor <i>fildes</i>[1] on a first-in-first-out basis.
It is unspecified whether <i>fildes</i>[0] is also open for writing and whether <i>fildes</i>[1] is also open for reading.</p>
<p>A process has the pipe open for reading (correspondingly writing) if it has a file descriptor open that refers to the read end,
<i>fildes</i>[0] (write end, <i>fildes</i>[1]).</p>
<p>The pipe's user ID shall be set to the effective user ID of the calling process.</p>
<p>The pipe's group ID shall be set to the effective group ID of the calling process.</p>
<p>Upon successful completion, <i>pipe</i>() shall mark for update the last data access, last data modification, and last file
status change timestamps of the pipe.</p>
<p>The <i>pipe2</i>() function shall be equivalent to the <i>pipe</i>() function, except that the state of O_NONBLOCK on the new
file descriptions and FD_CLOEXEC and FD_CLOFORK on the new file descriptors shall be determined solely by the <i>flag</i> argument,
which can be constructed from a bitwise-inclusive OR of flags from the following list (provided by <a href=
"../basedefs/fcntl.h.html"><i>&lt;fcntl.h&gt;</i></a>):</p>
<dl compact>
<dd></dd>
<dt>O_CLOEXEC</dt>
<dd>Atomically set the FD_CLOEXEC flag on both new file descriptors.</dd>
<dt>O_CLOFORK</dt>
<dd>Atomically set the FD_CLOFORK flag on both new file descriptors.</dd>
<dt>O_NONBLOCK</dt>
<dd>Set the O_NONBLOCK file status flag on both new file descriptions.</dd>
</dl>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_04" id="tag_17_377_04"></a>RETURN VALUE</h4>
<blockquote>
<p>Upon successful completion, 0 shall be returned; otherwise, -1 shall be returned and <i>errno</i> set to indicate the error, no
file descriptors shall be allocated and the contents of <i>fildes</i> shall be left unmodified.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_05" id="tag_17_377_05"></a>ERRORS</h4>
<blockquote>
<p>The <i>pipe</i>() and <i>pipe2</i>() functions shall fail if:</p>
<dl compact>
<dd></dd>
<dt>[EMFILE]</dt>
<dd>All, or all but one, of the file descriptors available to the process are currently open.</dd>
<dt>[ENFILE]</dt>
<dd>The number of simultaneously open files in the system would exceed a system-imposed limit.</dd>
</dl>
<p>The <i>pipe2</i>() function may fail if:</p>
<dl compact>
<dd></dd>
<dt>[EINVAL]</dt>
<dd>The value of the <i>flag</i> argument is invalid.</dd>
</dl>
</blockquote>
<hr>
<div class="box"><em>The following sections are informative.</em></div>
<h4 class="mansect"><a name="tag_17_377_06" id="tag_17_377_06"></a>EXAMPLES</h4>
<blockquote>
<h5><a name="tag_17_377_06_01" id="tag_17_377_06_01"></a>Using a Pipe to Pass Data Between a Parent Process and a Child
Process</h5>
<p>The following example demonstrates the use of a pipe to transfer data between a parent process and a child process. Error
handling is excluded, but otherwise this code demonstrates good practice when using pipes: after the <a href=
"../functions/fork.html"><i>fork</i>()</a> the two processes close the unused ends of the pipe before they commence transferring
data.</p>
<pre>
<tt>#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
...
<br>
int fildes[2];
const int BSIZE = 100;
char buf[BSIZE];
ssize_t nbytes;
int status;
<br>
status = pipe(fildes);
if (status == -1 ) {
    /* an error occurred */
    ...
}
<br>
switch (fork()) {
case -1: /* Handle error */
    break;
<br>
case 0:  /* Child - reads from pipe */
    close(fildes[1]);                       /* Write end is unused */
    nbytes = read(fildes[0], buf, BSIZE);   /* Get data from pipe */
    /* At this point, a further read would see end-of-file ... */
    close(fildes[0]);                       /* Finished with pipe */
    exit(EXIT_SUCCESS);
<br>
default:  /* Parent - writes to pipe */
    close(fildes[0]);                       /* Read end is unused */
    write(fildes[1], "Hello world\n", 12);  /* Write data on pipe */
    close(fildes[1]);                       /* Child will see EOF */
    exit(EXIT_SUCCESS);
}
</tt></pre></blockquote>
<h4 class="mansect"><a name="tag_17_377_07" id="tag_17_377_07"></a>APPLICATION USAGE</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_08" id="tag_17_377_08"></a>RATIONALE</h4>
<blockquote>
<p>The wording carefully avoids using the verb &quot;to open&quot; in order to avoid any implication of use of <a href=
"../functions/open.html"><i>open</i>()</a>; see also <a href="../functions/write.html"><i>write</i>()</a>.</p>
<p>The O_CLOEXEC and O_CLOFORK flags of <i>pipe2</i>() are necessary to avoid a data race in multi-threaded applications. Without
O_CLOFORK, a file descriptor is leaked into a child process created by one thread in the window between another thread creating a
file descriptor with <i>pipe</i>() and then using <a href="../functions/fcntl.html"><i>fcntl</i>()</a> to set the FD_CLOFORK flag.
Without O_CLOEXEC, a file descriptor intentionally inherited by child processes is similarly leaked into an executed program if
FD_CLOEXEC is not set atomically.</p>
<p>Since pipes are often used for communication between a parent and child process, O_CLOFORK has to be used with care in order for
the pipe to be usable. If the parent will be writing and the child will be reading, O_CLOFORK should be used when creating the
pipe, and then <a href="../functions/fcntl.html"><i>fcntl</i>()</a> should be used to clear FD_CLOFORK for the read side of the
pipe. This prevents the write side from leaking into other children, ensuring the child will get end-of-file when the parent closes
the write side (although the read side can still be leaked). If the parent will be reading and the child will be writing, there is
no way to prevent the write side being leaked (short of preventing other threads from creating child processes) in order to ensure
the parent gets end-of-file when the child closes the write side, and so the two processes should use an alternative method of
indicating the end of communications.</p>
<p>Arranging for FD_CLOEXEC to be set appropriately is more straightforward. The parent should use O_CLOEXEC when creating the pipe
and the child should clear FD_CLOEXEC on the side to be passed to the new program before calling an <i><a href=
"../functions/exec.html">exec</a></i> family function to execute it.</p>
<p>The O_NONBLOCK flag is for convenience in avoiding additional <a href="../functions/fcntl.html"><i>fcntl</i>()</a> calls.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_09" id="tag_17_377_09"></a>FUTURE DIRECTIONS</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_10" id="tag_17_377_10"></a>SEE ALSO</h4>
<blockquote>
<p><a href="../functions/V2_chap02.html#tag_16_06"><i>2.6 File Descriptor Allocation</i></a>, <a href=
"../functions/fcntl.html#"><i>fcntl</i>()</a>, <a href="../functions/read.html#tag_17_476"><i>read</i>()</a>, <a href=
"../functions/write.html#tag_17_699"><i>write</i>()</a></p>
<p>XBD <a href="../basedefs/fcntl.h.html"><i>&lt;fcntl.h&gt;</i></a>, <a href=
"../basedefs/unistd.h.html"><i>&lt;unistd.h&gt;</i></a></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_11" id="tag_17_377_11"></a>CHANGE HISTORY</h4>
<blockquote>
<p>First released in Issue 1. Derived from Issue 1 of the SVID.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_12" id="tag_17_377_12"></a>Issue 6</h4>
<blockquote>
<p>The following new requirements on POSIX implementations derive from alignment with the Single UNIX Specification:</p>
<ul>
<li>
<p>The DESCRIPTION is updated to indicate that certain dispositions of <i>fildes</i>[0] and <i>fildes</i>[1] are unspecified.</p>
</li>
</ul>
<p>IEEE&nbsp;Std&nbsp;1003.1-2001/Cor&nbsp;2-2004, item XSH/TC2/D6/65 is applied, adding the example to the EXAMPLES
section.<br></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_13" id="tag_17_377_13"></a>Issue 7</h4>
<blockquote>
<p>SD5-XSH-ERN-156 is applied, updating the DESCRIPTION to state the setting of the pipe's user ID and group ID.</p>
<p>Changes are made related to support for finegrained timestamps.</p>
<p>POSIX.1-2008, Technical Corrigendum 2, XSH/TC2-2008/0247 [835] and XSH/TC2-2008/0248 [467,835] are applied.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_377_14" id="tag_17_377_14"></a>Issue 8</h4>
<blockquote>
<p>Austin Group Defects 411, 1318, and 1577 are applied, adding <i>pipe2</i>() and FD_CLOFORK.</p>
<p>Austin Group Defect 1576 is applied, adding the word &quot;respectively&quot;.</p>
</blockquote>
<div class="box"><em>End of informative text.</em></div>
<hr>
<p>&nbsp;</p>
<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX® is a registered Trademark of The Open Group.<br>
POSIX™ is a Trademark of The IEEE.<br>
Copyright © 2001-2024 The IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>
<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/perror.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/poll.html" accesskey="N">Next &gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
</body>
</html>
