<!-- Copyright 2001-2024 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML>
<html lang="en">
<head>
<meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2024 The Open Group, All Rights Reserved -->
<title>readdir</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/read.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/readlink.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
<script language="JavaScript" src="../jscript/codes.js"></script><basefont size="3">
<center><font size="2">The Open Group Base Specifications Issue 8<br>
IEEE Std 1003.1-2024<br>
Copyright © 2001-2024 The IEEE and The Open Group</font></center>
<hr size="2" noshade>
<a name="top" id="top"></a> <a name="readdir" id="readdir"></a> <a name="tag_17_477" id="tag_17_477"></a><!-- readdir -->
<h4 class="mansect"><a name="tag_17_477_01" id="tag_17_477_01"></a>NAME</h4>
<blockquote>readdir, readdir_r — read a directory</blockquote>
<h4 class="mansect"><a name="tag_17_477_02" id="tag_17_477_02"></a>SYNOPSIS</h4>
<blockquote class="synopsis">
<p><code><tt>#include &lt;<a href="../basedefs/dirent.h.html">dirent.h</a>&gt;<br>
<br>
struct dirent *readdir(DIR *</tt><i>dirp</i><tt>);<br></tt></code></p>
<div class="box"><code><tt><sup>[<a href="javascript:open_code('OB')">OB</a>]</sup> <img src="../images/opt-start.gif" alt=
"[Option Start]" border="0"> int readdir_r(DIR *restrict</tt> <i>dirp</i><tt>, struct dirent *restrict</tt> <i>entry</i><tt>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct dirent **restrict</tt> <i>result</i><tt>); <img src="../images/opt-end.gif" alt=
"[Option End]" border="0"></tt></code></div>
<tt><br></tt></blockquote>
<h4 class="mansect"><a name="tag_17_477_03" id="tag_17_477_03"></a>DESCRIPTION</h4>
<blockquote>
<p>The type <b>DIR</b>, which is defined in the <a href="../basedefs/dirent.h.html"><i>&lt;dirent.h&gt;</i></a> header, represents
a <i>directory stream</i>, which is an ordered sequence of all the directory entries in a particular directory. Directory entries
represent files; files may be removed from a directory or added to a directory asynchronously to the operation of
<i>readdir</i>().</p>
<p>The <i>readdir</i>() function shall return a pointer to a structure representing the directory entry at the current position in
the directory stream specified by the argument <i>dirp</i>, and position the directory stream at the next entry. It shall return a
null pointer upon reaching the end of the directory stream. The structure <b>dirent</b> defined in the <a href=
"../basedefs/dirent.h.html"><i>&lt;dirent.h&gt;</i></a> header describes a directory entry. The value of the structure's
<i>d_ino</i> member shall be set to the file serial number of the file named by the <i>d_name</i> member. If the <i>d_name</i>
member names a symbolic link, the value of the <i>d_ino</i> member shall be set to the file serial number of the symbolic link
itself. The <i>d_name</i> member shall be a filename string, and (if not dot or dot-dot) shall contain the same byte sequence as
the last pathname component of the string used to create the directory entry, plus the terminating &lt;NUL&gt; byte.</p>
<p>The <i>readdir</i>() function shall not return directory entries containing empty names. If entries for dot or dot-dot exist,
one entry shall be returned for dot and one entry shall be returned for dot-dot; otherwise, they shall not be returned.</p>
<p>The application shall not modify the structure to which the return value of <i>readdir</i>() points, nor any storage areas
pointed to by pointers within the structure. The returned pointer, and pointers within the structure, might be invalidated or the
structure or the storage areas might be overwritten by a subsequent call to <i>readdir</i>() on the same directory stream. They
shall not be affected by a call to <i>readdir</i>() on a different directory stream. The returned pointer, and pointers within the
structure, might also be invalidated if the calling thread is terminated.</p>
<p>If a file is removed from or added to the directory after the most recent call to <a href=
"../functions/opendir.html"><i>opendir</i>()</a> or <a href="../functions/rewinddir.html"><i>rewinddir</i>()</a>, whether a
subsequent call to <i>readdir</i>() returns an entry for that file is unspecified.</p>
<p>The <i>readdir</i>() function may buffer several directory entries per actual read operation; <i>readdir</i>() shall mark for
update the last data access timestamp of the directory each time the directory is actually read.</p>
<p>After a call to <a href="../functions/fork.html"><i>fork</i>()</a>, either the parent or child (but not both) may continue
processing the directory stream using <i>readdir</i>(), <a href="../functions/rewinddir.html"><i>rewinddir</i>()</a>,
<sup>[<a href="javascript:open_code('XSI')">XSI</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
&nbsp;or <a href="../functions/seekdir.html"><i>seekdir</i>()</a>. <img src="../images/opt-end.gif" alt="[Option End]" border="0">
If both the parent and child processes use these functions, the result is undefined.</p>
<p>The <i>readdir</i>() function need not be thread-safe if concurrent calls are made for the same directory stream.</p>
<p>Applications wishing to check for error situations should set <i>errno</i> to 0 before calling <i>readdir</i>(). If <i>errno</i>
is set to non-zero on return, an error occurred.</p>
<p><sup>[<a href="javascript:open_code('OB')">OB</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0"> The
<i>readdir_r</i>() function shall initialize the <b>dirent</b> structure referenced by <i>entry</i> to represent the directory
entry at the current position in the directory stream referred to by <i>dirp</i>, store a pointer to this structure at the location
referenced by <i>result</i>, and position the directory stream at the next entry.</p>
<p>The storage pointed to by <i>entry</i> shall be large enough for a <b>dirent</b> with an array of <b>char</b> <i>d_name</i>
members containing at least {NAME_MAX}+1 elements.</p>
<p>Upon successful return, the pointer returned at *<i>result</i> shall have the same value as the argument <i>entry</i>. Upon
reaching the end of the directory stream, this pointer shall have the value NULL.</p>
<p>The <i>readdir_r</i>() function shall not return directory entries containing empty names.</p>
<p>If a file is removed from or added to the directory after the most recent call to <a href=
"../functions/opendir.html"><i>opendir</i>()</a> or <a href="../functions/rewinddir.html"><i>rewinddir</i>()</a>, whether a
subsequent call to <i>readdir_r</i>() returns an entry for that file is unspecified.</p>
<p>The <i>readdir_r</i>() function may buffer several directory entries per actual read operation; <i>readdir_r</i>() shall mark
for update the last data access timestamp of the directory each time the directory is actually read. <img src=
"../images/opt-end.gif" alt="[Option End]" border="0"></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_04" id="tag_17_477_04"></a>RETURN VALUE</h4>
<blockquote>
<p>Upon successful completion, <i>readdir</i>() shall return a pointer to an object of type <b>struct dirent</b>. When an error is
encountered, a null pointer shall be returned and <i>errno</i> shall be set to indicate the error. When the end of the directory is
encountered, a null pointer shall be returned and <i>errno</i> is not changed.</p>
<p><sup>[<a href="javascript:open_code('OB')">OB</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0"> If
successful, the <i>readdir_r</i>() function shall return zero; otherwise, an error number shall be returned to indicate the error.
<img src="../images/opt-end.gif" alt="[Option End]" border="0"></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_05" id="tag_17_477_05"></a>ERRORS</h4>
<blockquote>
<p>The <i>readdir</i>() <sup>[<a href="javascript:open_code('OB')">OB</a>]</sup> <img src="../images/opt-start.gif" alt=
"[Option Start]" border="0"> &nbsp;and <i>readdir_r</i>() <img src="../images/opt-end.gif" alt="[Option End]" border="0">
&nbsp;functions shall fail if:</p>
<dl compact>
<dd></dd>
<dt>[EOVERFLOW]</dt>
<dd>One of the values in the structure to be returned cannot be represented correctly.</dd>
<dt>[ENOMEM]</dt>
<dd>Insufficient memory is available.</dd>
</dl>
<p>The <i>readdir</i>() <sup>[<a href="javascript:open_code('OB')">OB</a>]</sup> <img src="../images/opt-start.gif" alt=
"[Option Start]" border="0"> &nbsp;and <i>readdir_r</i>() <img src="../images/opt-end.gif" alt="[Option End]" border="0">
&nbsp;functions may fail if:</p>
<dl compact>
<dd></dd>
<dt>[EBADF]</dt>
<dd>The <i>dirp</i> argument does not refer to an open directory stream.</dd>
<dt>[ENOENT]</dt>
<dd>The current position of the directory stream is invalid.</dd>
</dl>
</blockquote>
<hr>
<div class="box"><em>The following sections are informative.</em></div>
<h4 class="mansect"><a name="tag_17_477_06" id="tag_17_477_06"></a>EXAMPLES</h4>
<blockquote>
<p>The following sample program searches the current directory for each of the arguments supplied on the command line.</p>
<pre>
<tt>#include &lt;dirent.h&gt;
#include &lt;errno.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
<br>
static void lookup(const char *arg)
{
    DIR *dirp;
    struct dirent *dp;
<br>
    if ((dirp = opendir(".")) == NULL) {
        perror("couldn't open '.'");
        return;
    }
<br>
    do {
        errno = 0;
        if ((dp = readdir(dirp)) != NULL) {
            if (strcmp(dp-&gt;d_name, arg) != 0)
                continue;
<br>
            (void) printf("found %s\n", arg);
            (void) closedir(dirp);
                return;
<br>
        }
    } while (dp != NULL);
<br>
    if (errno != 0)
        perror("error reading directory");
    else
        (void) printf("failed to find %s\n", arg);
    (void) closedir(dirp);
    return;
}
<br>
int main(int argc, char *argv[])
{
    int i;
    for (i = 1; i &lt; argc; i++)
        lookup(argv[i]);
    return (0);
}
</tt></pre></blockquote>
<h4 class="mansect"><a name="tag_17_477_07" id="tag_17_477_07"></a>APPLICATION USAGE</h4>
<blockquote>
<p>The <i>readdir</i>() function should be used in conjunction with <a href="../functions/opendir.html"><i>opendir</i>()</a>,
<a href="../functions/closedir.html"><i>closedir</i>()</a>, and <a href="../functions/rewinddir.html"><i>rewinddir</i>()</a> to
examine the contents of the directory.</p>
<p>The <i>readdir_r</i>() function returns values in a user-supplied buffer, but does not allow the size of the buffer to be
specified by the caller. If {NAME_MAX} is indeterminate, there is no way for an application to know how large the buffer needs to
be and <i>readdir_r</i>() cannot safely be used.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_08" id="tag_17_477_08"></a>RATIONALE</h4>
<blockquote>
<p>The returned value of <i>readdir</i>() merely <i>represents</i> a directory entry. No equivalence should be inferred.</p>
<p>Historical implementations of <i>readdir</i>() obtain multiple directory entries on a single read operation, which permits
subsequent <i>readdir</i>() operations to operate from the buffered information. Any wording that required each successful
<i>readdir</i>() operation to mark the directory last data access timestamp for update would disallow such historical
performance-oriented implementations.</p>
<p>When returning a directory entry for the root of a mounted file system, some historical implementations of <i>readdir</i>()
returned the file serial number of the underlying mount point, rather than of the root of the mounted file system. This behavior is
considered to be a bug, since the underlying file serial number has no significance to applications.</p>
<p>Since <i>readdir</i>() returns NULL when it detects an error and when the end of the directory is encountered, an application
that needs to tell the difference must set <i>errno</i> to zero before the call and check it if NULL is returned. Since the
function must not change <i>errno</i> in the second case and must set it to a non-zero value in the first case, a zero <i>errno</i>
after a call returning NULL indicates end-of-directory; otherwise, an error.</p>
<p>Routines to deal with this problem more directly were proposed:</p>
<pre>
<tt>int derror (</tt><i>dirp</i><tt>)
DIR *</tt><i>dirp</i><tt>;
<br>
void clearderr (</tt><i>dirp</i><tt>)
DIR *</tt><i>dirp</i><tt>;
</tt></pre>
<p>The first would indicate whether an error had occurred, and the second would clear the error indication. The simpler method
involving <i>errno</i> was adopted instead by requiring that <i>readdir</i>() not change <i>errno</i> when end-of-directory is
encountered.</p>
<p>An error or signal indicating that a directory has changed while open was considered but rejected.</p>
<p>Historically, <i>readdir</i>() returned a pointer to an internal static buffer that was overwritten by each call. The
<i>readdir_r</i>() function was added as a thread-safe alternative that returns values in a user-supplied buffer. However, it does
not allow the size of the buffer to be specified by the caller, and so is only usable if {NAME_MAX} is a compile-time constant or
<a href="../functions/fpathconf.html"><i>fpathconf</i>()</a> with _SC_NAME_MAX returns a value other than -1. If {NAME_MAX} is
indeterminate (indicated by <a href="../functions/fpathconf.html"><i>fpathconf</i>()</a> returning -1), there is no way to reliably
allocate a buffer large enough to hold a filename being returned by <i>readdir_r</i>(). Therefore, <i>readdir_r</i>() has been
marked obsolescent and <i>readdir</i>() is now required to be thread safe as long as there are no concurrent calls to it on a
single directory stream.</p>
<p>Conforming file systems are required to store filenames unaltered from how they were created (via <a href=
"../functions/open.html"><i>open</i>()</a>, <a href="../functions/link.html"><i>link</i>()</a>, <a href=
"../functions/mkdir.html"><i>mkdir</i>()</a>, <a href="../functions/mkfifo.html"><i>mkfifo</i>()</a>, <a href=
"../functions/rename.html"><i>rename</i>()</a>, etc.). By definition, a filename string does not include a &lt;slash&gt;, even if a
trailing &lt;slash&gt; was present in the pathname presented to <a href="../functions/mkdir.html"><i>mkdir</i>()</a> when creating
a sub-directory.</p>
<p>However, there are non-conforming file systems where filenames are converted to a canonical representation before a directory
entry is created, such that it is possible to create a file using one string, then perform <a href=
"../functions/opendir.html"><i>opendir</i>()</a> and a <i>readdir</i>() loop and not encounter the same string, because
<i>readdir</i>() returns the canonical form of the string instead. Such non-conforming file systems also have the issue that
multiple filenames can resolve to the same directory entry, with potentially confusing results. This standard cannot mandate the
behavior of non-conforming file systems, and strictly conforming applications need not worry about dealing with such file systems,
but it is a concern for developers of portable applications. Therefore, this standard recommends that file system implementations
that perform canonicalization of filenames should reject attempts to create a directory entry with a non-canonical filename using
the [EILSEQ] error. However, if a directory entry already exists, it is reasonable for a file system to permit accessing that file
via a non-canonical filename.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_09" id="tag_17_477_09"></a>FUTURE DIRECTIONS</h4>
<blockquote>
<p>The <i>readdir_r</i>() function may be removed in a future version.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_10" id="tag_17_477_10"></a>SEE ALSO</h4>
<blockquote>
<p><a href="../functions/closedir.html#"><i>closedir</i>()</a>, <a href="../functions/dirfd.html#"><i>dirfd</i>()</a>, <a href=
"../functions/exec.html#tag_17_129"></a><a href="../functions/exec.html">exec</a>, <a href=
"../functions/fdopendir.html#"><i>fdopendir</i>()</a>, <a href="../functions/fstatat.html#"><i>fstatat</i>()</a>, <a href=
"../functions/posix_getdents.html#"><i>posix_getdents</i>()</a>, <a href="../functions/rewinddir.html#"><i>rewinddir</i>()</a>,
<a href="../functions/symlink.html#"><i>symlink</i>()</a></p>
<p>XBD <a href="../basedefs/dirent.h.html"><i>&lt;dirent.h&gt;</i></a>, <a href=
"../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_11" id="tag_17_477_11"></a>CHANGE HISTORY</h4>
<blockquote>
<p>First released in Issue 2.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_12" id="tag_17_477_12"></a>Issue 5</h4>
<blockquote>
<p>Large File Summit extensions are added.</p>
<p>The <i>readdir_r</i>() function is included for alignment with the POSIX Threads Extension.</p>
<p>A note indicating that the <i>readdir</i>() function need not be reentrant is added to the DESCRIPTION.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_13" id="tag_17_477_13"></a>Issue 6</h4>
<blockquote>
<p>The <i>readdir_r</i>() function is marked as part of the Thread-Safe Functions option.</p>
<p>The Open Group Corrigendum U026/7 is applied, correcting the prototype for <i>readdir_r</i>().</p>
<p>The Open Group Corrigendum U026/8 is applied, clarifying the wording of the successful return for the <i>readdir_r</i>()
function.</p>
<p>The following new requirements on POSIX implementations derive from alignment with the Single UNIX Specification:</p>
<ul>
<li>
<p>The requirement to include <a href="../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a> has been removed. Although
<a href="../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a> was required for conforming implementations of previous POSIX
specifications, it was not required for UNIX applications.</p>
</li>
<li>
<p>A statement is added to the DESCRIPTION indicating the disposition of certain fields in <b>struct dirent</b> when an entry
refers to a symbolic link.</p>
</li>
<li>
<p>The [EOVERFLOW] mandatory error condition is added. This change is to support large files.</p>
</li>
<li>
<p>The [ENOENT] optional error condition is added.</p>
</li>
</ul>
<p>The APPLICATION USAGE section is updated to include a note on the thread-safe function and its avoidance of possibly using a
static data area.</p>
<p>The <b>restrict</b> keyword is added to the <i>readdir_r</i>() prototype for alignment with the ISO/IEC&nbsp;9899:1999
standard.</p>
<p>IEEE&nbsp;Std&nbsp;1003.1-2001/Cor&nbsp;1-2002, item XSH/TC1/D6/50 is applied, replacing the EXAMPLES section with a new
example.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_14" id="tag_17_477_14"></a>Issue 7</h4>
<blockquote>
<p>Austin Group Interpretation 1003.1-2001 #059 is applied, updating the ERRORS section.</p>
<p>Austin Group Interpretation 1003.1-2001 #156 is applied.</p>
<p>The <i>readdir_r</i>() function is moved from the Thread-Safe Functions option to the Base.</p>
<p>Changes are made related to support for finegrained timestamps.</p>
<p>The value of the <i>d_ino</i> member is no longer unspecified for symbolic links.</p>
<p>SD5-XSH-ERN-193 is applied.</p>
<p>POSIX.1-2008, Technical Corrigendum 1, XSH/TC1-2008/0486 [75] is applied.</p>
<p>POSIX.1-2008, Technical Corrigendum 2, XSH/TC2-2008/0304 [656] is applied.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_477_15" id="tag_17_477_15"></a>Issue 8</h4>
<blockquote>
<p>Austin Group Defect 293 is applied, adding a requirement that <i>d_name</i> contains the same byte sequence as the last pathname
component of the string used to create the directory entry.</p>
<p>Austin Group Defects 696 and 1664 are applied, making <i>readdir_r</i>() obsolescent, requiring <i>readdir</i>() to be
thread-safe except when concurrent calls are made for the same directory stream, and adding the [ENOMEM] error.</p>
<p>Austin Group Defect 697 is applied, adding <a href="../functions/posix_getdents.html"><i>posix_getdents</i>()</a> to the SEE
ALSO section.</p>
</blockquote>
<div class="box"><em>End of informative text.</em></div>
<hr>
<p>&nbsp;</p>
<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX® is a registered Trademark of The Open Group.<br>
POSIX™ is a Trademark of The IEEE.<br>
Copyright © 2001-2024 The IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>
<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/read.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/readlink.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
</body>
</html>
