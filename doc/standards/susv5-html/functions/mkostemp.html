<!-- Copyright 2001-2024 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML>
<html lang="en">
<head>
<meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2024 The Open Group, All Rights Reserved -->
<title>mkdtemp</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/mkdir.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/mkfifo.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
<script language="JavaScript" src="../jscript/codes.js"></script><basefont size="3">
<center><font size="2">The Open Group Base Specifications Issue 8<br>
IEEE Std 1003.1-2024<br>
Copyright © 2001-2024 The IEEE and The Open Group</font></center>
<hr size="2" noshade>
<a name="top" id="top"></a> <a name="mkdtemp" id="mkdtemp"></a> <a name="tag_17_339" id="tag_17_339"></a><!-- mkdtemp -->
<h4 class="mansect"><a name="tag_17_339_01" id="tag_17_339_01"></a>NAME</h4>
<blockquote>mkdtemp, mkostemp, mkstemp — create a unique directory or file</blockquote>
<h4 class="mansect"><a name="tag_17_339_02" id="tag_17_339_02"></a>SYNOPSIS</h4>
<blockquote class="synopsis">
<div class="box"><code><tt><sup>[<a href="javascript:open_code('CX')">CX</a>]</sup> <img src="../images/opt-start.gif" alt=
"[Option Start]" border="0"> #include &lt;<a href="../basedefs/stdlib.h.html">stdlib.h</a>&gt;<br>
<br>
char *mkdtemp(char *</tt><i>template</i><tt>);<br>
int mkostemp(char *</tt><i>template</i><tt>, int</tt> <i>flag</i><tt>);<br>
int mkstemp(char *</tt><i>template</i><tt>); <img src="../images/opt-end.gif" alt="[Option End]" border="0"></tt></code></div>
<tt><br></tt></blockquote>
<h4 class="mansect"><a name="tag_17_339_03" id="tag_17_339_03"></a>DESCRIPTION</h4>
<blockquote>
<p>The <i>mkdtemp</i>() function shall create a directory with a unique name derived from <i>template</i>. The application shall
ensure that the string provided in <i>template</i> is a pathname ending with at least six trailing <tt>'X'</tt> characters. The
<i>mkdtemp</i>() function shall modify the contents of <i>template</i> by replacing six or more <tt>'X'</tt> characters at the end
of the pathname with the same number of characters from the portable filename character set. The characters shall be chosen such
that the resulting pathname does not duplicate the name of an existing file at the time of the call to <i>mkdtemp</i>(). The
<i>mkdtemp</i>() function shall use the resulting pathname to create the new directory as if by a call to:</p>
<pre>
<tt>mkdir(pathname, S_IRWXU)
</tt></pre>
<p>The <i>mkstemp</i>() function shall create a regular file with a unique name derived from <i>template</i> and return a file
descriptor for the file open for reading and writing. The application shall ensure that the string provided in <i>template</i> is a
pathname ending with at least six trailing <tt>'X'</tt> characters. The <i>mkstemp</i>() function shall modify the contents of
<i>template</i> by replacing six or more <tt>'X'</tt> characters at the end of the pathname with the same number of characters from
the portable filename character set. The characters shall be chosen such that the resulting pathname does not duplicate the name of
an existing file at the time of the call to <i>mkstemp</i>(). The <i>mkstemp</i>() function shall use the resulting pathname to
create the file, and obtain a file descriptor for it, as if by a call to:</p>
<pre>
<tt>open(pathname, O_RDWR|O_CREAT|O_EXCL, S_IRUSR|S_IWUSR)
</tt></pre>
<p>By behaving as if the O_EXCL flag for <a href="../functions/open.html"><i>open</i>()</a> is set, the function prevents any
possible race condition between testing whether the file exists and opening it for use.</p>
<p>The <i>mkostemp</i>() function shall be equivalent to the <i>mkstemp</i>() function, except that the <i>flag</i> argument can
contain additional flags to be used as if by <a href="../functions/open.html"><i>open</i>()</a>. Behavior is unspecified if the
<i>flag</i> argument contains more than the following flags:</p>
<dl compact>
<dd></dd>
<dt>O_APPEND</dt>
<dd>Set append mode.</dd>
<dt>O_CLOEXEC</dt>
<dd>Set the FD_CLOEXEC file descriptor flag.</dd>
<dt>O_CLOFORK</dt>
<dd>Set the FD_CLOFORK file descriptor flag.</dd>
<dt>O_DSYNC</dt>
<dd><sup>[<a href="javascript:open_code('SIO')">SIO</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
Write according to the synchronized I/O data integrity completion. <img src="../images/opt-end.gif" alt="[Option End]" border=
"0"></dd>
<dt>O_RSYNC</dt>
<dd><sup>[<a href="javascript:open_code('SIO')">SIO</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
Synchronized read I/O operations. <img src="../images/opt-end.gif" alt="[Option End]" border="0"></dd>
<dt>O_SYNC</dt>
<dd><sup>[<a href="javascript:open_code('XSI')">XSI|SIO</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border=
"0"> Write according to synchronized I/O file integrity completion. <img src="../images/opt-end.gif" alt="[Option End]" border=
"0"></dd>
</dl>
</blockquote>
<h4 class="mansect"><a name="tag_17_339_04" id="tag_17_339_04"></a>RETURN VALUE</h4>
<blockquote>
<p>Upon successful completion, the <i>mkdtemp</i>() function shall return the value of <i>template</i>. Otherwise, it shall return
a null pointer and shall set <i>errno</i> to indicate the error.</p>
<p>Upon successful completion, the <i>mkstemp</i>() function shall return an open file descriptor. Otherwise, it shall return -1
and shall set <i>errno</i> to indicate the error.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_339_05" id="tag_17_339_05"></a>ERRORS</h4>
<blockquote>
<p>These functions shall fail if:</p>
<dl compact>
<dd></dd>
<dt>[EINVAL]</dt>
<dd>The string pointed to by <i>template</i> does not end in <tt>"XXXXXX"</tt>.</dd>
</dl>
<p>The <i>mkostemp</i>() function may fail if:</p>
<dl compact>
<dd></dd>
<dt>[EINVAL]</dt>
<dd>The value of the <i>flag</i> argument is invalid.</dd>
</dl>
<p>Additional error conditions for the <i>mkdtemp</i>() function are defined in <a href=
"../functions/mkdir.html#tag_17_338"><i>mkdir</i>()</a>. Additional error conditions for the <i>mkstemp</i>() and
<i>mkostemp</i>() functions are defined in <a href="../functions/open.html#"><i>open</i>()</a>.</p>
</blockquote>
<hr>
<div class="box"><em>The following sections are informative.</em></div>
<h4 class="mansect"><a name="tag_17_339_06" id="tag_17_339_06"></a>EXAMPLES</h4>
<blockquote>
<h5><a name="tag_17_339_06_01" id="tag_17_339_06_01"></a>Generating a Pathname</h5>
<p>The following example creates a file with a 10-character name beginning with the characters <tt>"file"</tt> and opens the file
for reading and writing. The value returned as the value of <i>fd</i> is a file descriptor that identifies the file.</p>
<pre>
<tt>#include &lt;stdlib.h&gt;
...
char template[] = "/tmp/fileXXXXXX";
int fd;
<br>
fd = mkstemp(template);
</tt></pre></blockquote>
<h4 class="mansect"><a name="tag_17_339_07" id="tag_17_339_07"></a>APPLICATION USAGE</h4>
<blockquote>
<p>It is possible to run out of letters.</p>
<p>Portable applications should pass exactly six trailing <tt>'X'</tt>s in the template and no more; implementations may treat any
additional trailing <tt>'X'</tt>s as either a fixed or replaceable part of the template. To be sure of only passing six, a fixed
string of at least one non-<tt>'X'</tt> character should precede the six <tt>'X'</tt>s.</p>
<p>Since <tt>'X'</tt> is in the portable filename character set, some of the replacement characters can be <tt>'X'</tt>s, leaving
part (or even all) of the template effectively unchanged.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_339_08" id="tag_17_339_08"></a>RATIONALE</h4>
<blockquote>
<p>The O_CLOEXEC and O_CLOFORK flags of <i>mkostemp</i>() are necessary to avoid a data race in multi-threaded applications.
Without O_CLOFORK, a file descriptor is leaked into a child process created by one thread in the window between another thread
creating a temporary file descriptor with <i>mkstemp</i>() and then using <a href="../functions/fcntl.html"><i>fcntl</i>()</a> to
set the FD_CLOFORK flag. Without O_CLOEXEC, a temporary file descriptor intentionally inherited by child processes is similarly
leaked into an executed program if FD_CLOEXEC is not set atomically.</p>
<p>Implementations are encouraged to have <i>mkdtemp</i>(), <i>mkostemp</i>(), and <i>mkstemp</i>() report an [EILSEQ] error if the
last component of the pathname in <i>template</i> contains any bytes that have the encoded value of a &lt;newline&gt;
character.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_339_09" id="tag_17_339_09"></a>FUTURE DIRECTIONS</h4>
<blockquote>
<p>None.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_339_10" id="tag_17_339_10"></a>SEE ALSO</h4>
<blockquote>
<p><a href="../functions/getpid.html#"><i>getpid</i>()</a>, <a href="../functions/mkdir.html#tag_17_338"><i>mkdir</i>()</a>,
<a href="../functions/open.html#"><i>open</i>()</a>, <a href="../functions/tmpfile.html#"><i>tmpfile</i>()</a>, <a href=
"../functions/tmpnam.html#"><i>tmpnam</i>()</a></p>
<p>XBD <a href="../basedefs/stdlib.h.html"><i>&lt;stdlib.h&gt;</i></a></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_339_11" id="tag_17_339_11"></a>CHANGE HISTORY</h4>
<blockquote>
<p>First released in Issue 4, Version 2.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_339_12" id="tag_17_339_12"></a>Issue 5</h4>
<blockquote>
<p>Moved from X/OPEN UNIX extension to BASE.<br></p>
</blockquote>
<h4 class="mansect"><a name="tag_17_339_13" id="tag_17_339_13"></a>Issue 7</h4>
<blockquote>
<p>Austin Group Interpretation 1003.1-2001 #143 is applied.</p>
<p>SD5-XSH-ERN-168 is applied, clarifying file permissions upon creation.</p>
<p>The <i>mkstemp</i>() function is moved from the XSI option to the Base.</p>
<p>The <i>mkdtemp</i>() function is added from The Open Group Technical Standard, 2006, Extended API Set Part 1.</p>
<p>POSIX.1-2008, Technical Corrigendum 1, XSH/TC1-2008/0380 [291], XSH/TC1-2008/0381 [324], and XSH/TC1-2008/0382 [291] are
applied.</p>
<p>POSIX.1-2008, Technical Corrigendum 2, XSH/TC2-2008/0215 [567,669] is applied.</p>
</blockquote>
<h4 class="mansect"><a name="tag_17_339_14" id="tag_17_339_14"></a>Issue 8</h4>
<blockquote>
<p>Austin Group Defect 251 is applied, encouraging implementations to disallow the creation of filenames containing any bytes that
have the encoded value of a &lt;newline&gt; character.</p>
<p>Austin Group Defects 411, 1318, and 1350 are applied, adding <i>mkostemp</i>().</p>
<p>Austin Group Defect 652 is applied, adding the [EINVAL] error for <i>mkstemp</i>().</p>
<p>Austin Group Defect 1734 is applied, replacing the error conditions specified only for <i>mkdtemp</i>() with a reference to
<a href="../functions/mkdir.html#tag_17_338"><i>mkdir</i>()</a>.</p>
</blockquote>
<div class="box"><em>End of informative text.</em></div>
<hr>
<p>&nbsp;</p>
<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX® is a registered Trademark of The Open Group.<br>
POSIX™ is a Trademark of The IEEE.<br>
Copyright © 2001-2024 The IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>
<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/mkdir.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/mkfifo.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>
<hr align="left" width="100%"></div>
</body>
</html>
